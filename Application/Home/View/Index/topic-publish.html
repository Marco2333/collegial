<include file="Common/header" title="发布话题" keywords="发布话题" description=""/>

	<div id="topic-publish-wrap">
		<form action="" method="post" enctype="multipart/form-data" onsubmit="return check();">
			<div class="ccreate-detail">
				<ul>
					<li class="topic-publish-item">
						<span>标题</span>
						<div class="cdinput-wrap">
							<input type="text" name="title" placeholder="请输入标题">
						</div>
					</li>
					<li class="topic-publish-item">
						<span>内容</span>
						<div class="cdinput-wrap">
							<textarea name="topic-detail" placeholder="请输入话题详情"></textarea>
						</div>
					</li>
					<p class="club-add-img">
						<img src="__PUBLIC__/images/add_picture.png" alt="">
						<input type="file" name="file[]">
					</p>
				</ul>
			</div>
			<button class="submit">立即发布</button>
		</form>
		<div class="info-mask center none" data-status=""></div>
	</div>

	<script>
		$(function() {
			var status = $(".info-mask").attr('data-status');
			if (status === '1' || status === '-1') {
				if (status === '1') {
					$(".info-mask").text('发布成功');
				} else {
					$(".info-mask").text('发布失败');
				}
				$(".info-mask").removeClass('none');
				setTimeout(function() {
					$(".info-mask").addClass('none');
				}, 1500);
			}

			$(".club-add-img").on('change', "input[type='file']", function() {
				var len, i, objUrl, val = $(this).val(),
					suffix = val.substring(val.lastIndexOf('.') + 1);

				if (['jpg', 'png', 'gif', 'jpeg', 'bmp'].indexOf(suffix.toLowerCase()) == -1) {
					alert("请上传图片文件！");
					$(this).val('');
					return;
				}

				objUrl = getObjectURL(this.files[0]);
				$("<img>").attr('src', objUrl).prependTo($(".club-add-img"));
				$(this).after($("<input type='file' name='file[]'>"));
			});
		})

		function check() {
			if(!$("input[name='title']").val().trim()) {
				alert("标题不能为空！");
				return false;
			}
			if(!$("textarea[name='topic-detail']").val().trim()) {
				alert("内容不能为空！");
				return false;
			}
			return true;
		}

		function getObjectURL(file) {
			var url = null;
			if (window.createObjectURL != undefined) { // basic
				url = window.createObjectURL(file);
			} else if (window.URL != undefined) { // mozilla(firefox)
				url = window.URL.createObjectURL(file);
			} else if (window.webkitURL != undefined) { // webkit or chrome
				url = window.webkitURL.createObjectURL(file);
			}
			return url;
		}
	</script>
<include file="Common/footer" />